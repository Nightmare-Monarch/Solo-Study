<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Study History</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
<style>
  body {
    background: #060b13;
    color: #fff;
    font-family: "Orbitron", sans-serif;
    margin: 0;
    padding: 20px;
  }

  h1 {
    text-align: center;
    margin-bottom: 20px;
    color: #00eaff;
    text-shadow: 0 0 10px #00eaff;
  }

  #historyList {
    max-width: 600px;
    margin: 0 auto;
  }

  .history-item {
    background: #0a0f1c;
    color: white;
    padding: 12px 18px;
    margin: 10px 0;
    border-radius: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 0 10px #00eaff33;
  }

  .remove-btn {
    background: #ff2f2f;
    border: none;
    color: white;
    padding: 5px 12px;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.2s;
    font-family: "Orbitron", sans-serif;
  }

  .remove-btn:hover {
    background: #ff5555;
  }

  .clear-all-btn {
    display: block;
    margin: 30px auto 0;
    background: #00eaff;
    color: black;
    border: none;
    padding: 10px 25px;
    border-radius: 10px;
    cursor: pointer;
    font-weight: bold;
    font-family: "Orbitron", sans-serif;
    transition: 0.3s;
  }

  .clear-all-btn:hover {
    background: #33f1ff;
  }

  /* Popup notification */
  #popup {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: #00eaff;
    color: #000;
    padding: 10px 25px;
    border-radius: 20px;
    font-weight: bold;
    font-family: "Orbitron", sans-serif;
    box-shadow: 0 0 15px #00eaff88;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s;
    z-index: 1000;
  }

  #popup.show {
    opacity: 1;
  }

</style>
</head>
<body>
  <h1>Study History</h1>
  <div id="historyList"></div>
  <button id="clearAllBtn" class="clear-all-btn">Clear All</button>

  <div id="popup"></div>

  <script>
    const historyList = document.getElementById("historyList");
    const clearAllBtn = document.getElementById("clearAllBtn");
    const popup = document.getElementById("popup");

    let studyHistory = JSON.parse(localStorage.getItem("studyHistory")) || [];
    let subjects = JSON.parse(localStorage.getItem("subjects")) || [];
    let totalXP = parseFloat(localStorage.getItem("totalXP")) || 0;

    function showPopup(message) {
      popup.textContent = message;
      popup.classList.add("show");
      setTimeout(() => popup.classList.remove("show"), 2500);
    }

    function renderHistory() {
      historyList.innerHTML = "";
      if (studyHistory.length === 0) {
        historyList.innerHTML = "<p style='text-align:center;'>No study sessions yet.</p>";
        return;
      }

      studyHistory.forEach((session, index) => {
        const div = document.createElement("div");
        div.classList.add("history-item");

        const text = document.createElement("span");
        text.textContent = `${session.subject} â€” ${session.duration}`;

        const removeBtn = document.createElement("button");
        removeBtn.textContent = "Remove";
        removeBtn.classList.add("remove-btn");

        removeBtn.addEventListener("click", () => removeSession(index));
        div.appendChild(text);
        div.appendChild(removeBtn);
        historyList.appendChild(div);
      });
    }

    function removeSession(index) {
      const session = studyHistory[index];
      if (!session) return;

      const totalMinutes = session.totalMinutes || 0;
      const hours = totalMinutes / 60;

      const marksGained = (hours / 15) * 100; // 15 hours = 100 marks
      const xpGained = hours * 50; // 1 hour = 50 XP

      totalXP -= xpGained;
      if (totalXP < 0) totalXP = 0;
      localStorage.setItem("totalXP", totalXP);

      const subject = subjects.find(s => s.name === session.subject);
      if (subject) {
        subject.marks -= marksGained;
        if (subject.marks < 0) subject.marks = 0;
      }

      studyHistory.splice(index, 1);
      localStorage.setItem("subjects", JSON.stringify(subjects));
      localStorage.setItem("studyHistory", JSON.stringify(studyHistory));

      renderHistory();
      showPopup(`Removed ${session.subject} â€” ${session.duration} âœ…`);
    }

    clearAllBtn.addEventListener("click", () => {
      if (confirm("Clear all study history? This will also reset your XP and marks.")) {
        localStorage.removeItem("studyHistory");
        localStorage.removeItem("subjects");
        localStorage.removeItem("totalXP");
        studyHistory = [];
        subjects = [];
        totalXP = 0;
        renderHistory();
        showPopup("All history cleared ðŸ”¥");
      }
    });

    renderHistory();
  </script>
</body>
</html>
